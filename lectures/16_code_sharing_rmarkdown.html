<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Code sharing: R Markdown</title>
    <meta charset="utf-8" />
    <meta name="author" content="Niklas M채hler" />
    <meta name="date" content="2021-10-14" />
    <script src="libs/header-attrs-2.11/header-attrs.js"></script>
    <link href="libs/remark-css-0.0.1/default.css" rel="stylesheet" />
    <link rel="stylesheet" href="css/niklas.css" type="text/css" />
    <link rel="stylesheet" href="css/niklas-fonts.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: left, middle, inverse, title-slide

# Code sharing: R Markdown
## Practical Skills for Biology Research II
### Niklas M채hler
### Ume책 University
### 2021-10-14

---


layout: true

<div class="footer">
<a href="https://github.com/maehler/psbr2/tree/main/lectures/16_code_sharing_rmarkdown.Rmd">
<svg viewBox="0 0 496 512" style="height:1em;position:relative;display:inline-block;top:.1em;" xmlns="http://www.w3.org/2000/svg">
<path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path>
</svg>
</a>
</div>

---

# First: What is Markdown?

The name markdown is a take on the work markup, as in HTML (Hyper-Text Markup Language).

.center[&lt;svg viewBox="0 0 640 512" style="position:relative;display:inline-block;top:.1em;height:10em;" xmlns="http://www.w3.org/2000/svg"&gt;  &lt;path d="M593.8 59.1H46.2C20.7 59.1 0 79.8 0 105.2v301.5c0 25.5 20.7 46.2 46.2 46.2h547.7c25.5 0 46.2-20.7 46.1-46.1V105.2c0-25.4-20.7-46.1-46.2-46.1zM338.5 360.6H277v-120l-61.5 76.9-61.5-76.9v120H92.3V151.4h61.5l61.5 76.9 61.5-76.9h61.5v209.2zm135.3 3.1L381.5 256H443V151.4h61.5V256H566z"&gt;&lt;/path&gt;&lt;/svg&gt;]

It is a mini-language for typesetting documents, making it easy to create headings, paragraphs, inserting images, hyperlinks, etc.

[The Markdown Guide](https://www.markdownguide.org/)

---

# [Markdown syntax](https://www.markdownguide.org/basic-syntax/)

## Headings

.pull-left[
```md
# First level

## Second level

### Third level

#### Fourth level
```
]

.pull-right[
# First level

## Second level

### Third level

#### Fourth level
]

---

# [Markdown syntax](https://www.markdownguide.org/basic-syntax/)

## Emphasis

.pull-left[
```md
This is **bold** text.

This is *italic* text.

This is ***bold and italic*** text.
```
]

.pull-right[
This is **bold** text.

This is *italic* text.

This is ***bold and italic*** text.
]

---

# [Markdown syntax](https://www.markdownguide.org/basic-syntax/)

## Lists

.pull-left[
```md
- First  item
- Second  item
- Third item

1. First item
2. Second item
3. Third item
```
]
.pull-right[
- First  item
- Second  item
- Third item

1. First item
2. Second item
3. Third item
]

---

# Rendering Markdown

The Markdown file format (file extension `.md`) is just a text file format.
In order to produce a proper document, we have to run it through an interpreter.
Nowadays, this is something that is often built-in into editors that support Markdown, including RStudio.

.pull-left.small[
```md
# This is a heading

 **Lorem** ipsum dolor sit amet, consecteturadipiscing elit.
Morbi blandit at augue eu accumsan. Nullam pharetra tortor non
leo sollicitudin, sed efficitur arcu auctor. Nullam quis magna
dapibus, volutpat libero eu, convallis mi.

- Lorem
- ipsum
- dolor

## References

[Lorem ipsum generator](https://www.lipsum.com/)
```
]

.pull-right.small[
# This is a heading

**Lorem** ipsum dolor sit amet, consecteturadipiscing elit.
Morbi blandit at augue eu accumsan. Nullam pharetra tortor non
leo sollicitudin, sed efficitur arcu auctor. Nullam quis magna
dapibus, volutpat libero eu, convallis mi.

- Lorem
- ipsum
- dolor

## References

[Lorem ipsum generator](https://www.lipsum.com/)
]

---

# R Markdown

R Markdown is a flavour of Markdown where we can include R code that can execute as we render the document.

.pull-left[
````md
I took a bunch of random numbers

```{r}
x &lt;- rnorm(10)
```

And I calculated the mean

```{r}
mean(x)
```
````
]

.pull-right[
I took a bunch of random numbers


```r
x &lt;- rnorm(10)
```

And I calculated the mean


```r
mean(x)
```

```
## [1] -0.1329441
```
]

???

As you can see here, whatever is produced in one code chunk will be kept in the environment of the document, so to say, while it's being rendered.
This means that we can use variables that we have defined in a code chunk later in the document.

---

# R Markdown

We can even include graphics.

.pull-left[
````md
Here's the distribution of diamond carats:

```{r}
ggplot(diamonds, aes(carat)) +
  geom_histogram()
```
````
]

.pull-right[
Here's the distribution of diamond carats:


```r
ggplot(diamonds, aes(carat)) +
  geom_histogram()
```

&lt;img src="./figures/code_sharing_rmarkdown_diamonds_histogram-1.png" width="432" /&gt;
]

---

# R Markdown in RStudio

Support for R Markdown is built-in to RStudio.

.pull-left[
![](../img/rstudio_menu_rmarkdown.png)
]

.pull-right[
![](../img/rstudio_menu_knitr.png)
]

---

# R Markdown preamble

When we create a new R Markdown document, we get an example document, and the first thing in the file is something like this:

```yaml
---
title: "My first R Markdown document"
author: "Niklas M채hler"
date: "9/16/2021"
output: html_document
---
```

This is a **preamble**, and it helps out in creating the title for our rendered document.
It can also be used to control the default format of our rendered document, as well as a whole bunch of other parameters.
For more information on this, check out the [R Markdown Cheat Sheet](https://github.com/rstudio/cheatsheets/blob/master/rmarkdown-2.0.pdf).

---

# Code chunks

.left-column[
## Introduction
]

.right-column[
We can create chunks of code in our document, that is executed when we compile the document.
These are initiated with three backticks, followed by `{r}`.
This tells the compiler that this is R code that it should execute.

````md
```{r}
x &lt;- rnorm(1000)
mean(x)
```
````
]

---

# Code chunks

.left-column[
## Introduction
## Labels
]

.right-column[
We can label our chunks like this

````md
```{r random_numbers}
x &lt;- rnorm(1000)
mean(x)
```
````

This can be very helpful, especially when having a larger document

![](../img/rmd_navigation.png)
]

---

# Code chunks

.left-column[
## Introduction
## Labels
## Options
]

.right-column[
There are a lot of options that we can set for code chunks.
All available options you can find in the [knitr documentation](https://yihui.org/knitr/options/#chunk-options).

They are written in the form of `tag = value`:

````md
```{r random_numbers, echo = TRUE, eval = FALSE}
x &lt;- rnorm(1000)
mean(x)
```
````

Some useful options are

- `echo`: Whether to render the code chunk or not.
- `eval`: Whether to actually execute the code in the chunk.
- `include`: Whether to render the chunk *and* its output.
- `fig.width`/`fig.height`: Control the size of figures.
- `message`: Whether or not to render messages.
- `warning`: Whether or not to render warnings.
- `fig.align`: How figures should be aligned on the page.
]

---

# Code chunks

.left-column[
## Introduction
## Labels
## Options
## Global options
]

.right-column[
Something that I find is a nice setup is to have a configuration chunk as the first chunk in the document.

````md
```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = FALSE, fig.width = 5, fig.height = 3,
                      message = FALSE, warning = FALSE,
                      fig.align = "center")
```
````
]

---

# Running code chunks

If a document gets big, or it contains long-running calculations, it can take quite some time to render (or **knit**).
We can run individual code chunks RStudio without knitting the whole document.

.center[
![:scale 50%](../img/rstudio_menu_run.png)
]

???

I'm very fond of keyboards, and keyboard shortcuts, so I almost never use the menus.

Now I will do a bit of a live demo of some R Markdown functionality.

---

# R Markdown references

- [RStudio R Markdown](https://rmarkdown.rstudio.com/): Contains the basics to get started.
- [R Markdown: The Definitive Guide](https://bookdown.org/yihui/rmarkdown/): The guide to everything R Markdown.
- [knitr](https://yihui.org/knitr/): The rendering engine for R Markdown where you can dig into the fine details.
- [R Markdown Cheat Sheet](https://github.com/rstudio/cheatsheets/blob/master/rmarkdown-2.0.pdf)

???

When it comes to the relly fine-grained nuances of R Markdown and knitr, don't think about that now.
I'm just throwing this out there so you know where to look in case you would be interested.
Also, if you continue to use RStudio and R Markdown, you will almost inevitably end up needing these references.

---

# Coding standards

.center[
![:scale 50%](https://imgs.xkcd.com/comics/code_quality.png)
]

A coding standard (or coding style) describes how source code should be written.
There are usually many different ones, and it is often the case that a workplace or a project group adopts their own coding standard.

What standard to use is not really that important.
The important thing is that everyone involved use the same coding standard.

[The tidyverse style guide](https://style.tidyverse.org/)

???

When sharing code, it is always good if the barrier for reading and being able to understand the code is as low as possible. 
This is something that can be helped by a coding standard.

---

# [The tidyverse style guide](https://style.tidyverse.org/)

As far as it is possible, don't reuse names of common functions or variables.


```r
# Bad
T &lt;- FALSE
c &lt;- 10
mean &lt;- function(x, ...) sum(x, ...)
```

Variable and function names should use only lowercase letters, numbers, and `_`.
Use underscores (`_`) (so called snake case) to separate words within a name.


```r
# Good
day_one
day_1

# Bad
DayOne
dayone
```

---

# [The tidyverse style guide](https://style.tidyverse.org/)

Use line breaks to make your code easier to read.


```r
iris %&gt;%
  group_by(Species) %&gt;%
  summarise(
    Sepal.Length = mean(Sepal.Length),
    Sepal.Width = mean(Sepal.Width),
    Species = n_distinct(Species)
  )
```


```r
# Good
ggplot(aes(x = Sepal.Width, y = Sepal.Length, color = Species)) +
  geom_point() +
  labs(
    x = "Sepal width, in cm",
    y = "Sepal length, in cm",
    title = "Sepal length vs. width of irises"
  ) 

# Bad
ggplot(aes(x = Sepal.Width, y = Sepal.Length, color = Species)) +
  geom_point() +
  labs(x = "Sepal width, in cm", y = "Sepal length, in cm", title = "Sepal length vs. width of irises") 
```


???

Here are some examples from the style guide, but I encourage you to skim through it yourself.

---

# Suggested reading

- [The tidyverse style guide](https://style.tidyverse.org/)
- [R Markdown: The Definitive Guide](https://bookdown.org/yihui/rmarkdown/)
- [knitr documentation](https://yihui.org/knitr/)
- [R Markdown Cheat Sheet](https://github.com/rstudio/cheatsheets/blob/master/rmarkdown-2.0.pdf)
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script src="js/macros.js"></script>
<script>var slideshow = remark.create({
"ratio": "16:9",
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false,
"navigation": {
"scroll": false
}
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
